---
layout: post
title: JPA (2)
category: JPA
---

## 데이터베이스 방언(Dialect)

<img src = "https://user-images.githubusercontent.com/77649948/106992099-04159280-67bb-11eb-93dd-3cab22b2f900.png" width="800">

- JPA는 특정 데이터베이스에 종속되지 않는다.
- 각각의 데이터베이스가 제공하는 SQL 문법과 함수는 조금씩 다르다.
- 방언은 SQL 표준을 지키지 않는 특정 데이터베이스만의 고유한 기능을 의미한다.
- JPA의 구현체인 하이버네이트는 40가지 이상의 데이터베이스 방언을 지원한다.

<br>
## JPA 구동 방식

<img src="https://user-images.githubusercontent.com/77649948/106992295-6ff7fb00-67bb-11eb-8346-614a2d55c4fe.png" width="800">

<br>
**주의**

- 엔티티 매니저 팩토리는 하나만 생성해서 애플리케이션 전체에서 공유된다.
- 엔티티 매니저는 쓰레드간에 공유하면 안된다. (사용하고 버려야 함)
- JPA의 모든 데이터 변경은 트랜잭션 안에서 실행해야 한다.

<br>
## 영속성 컨텍스트

- JPA를 이해하는데 가장 중요한 용어이다.
- "엔티티를 영구 저장하는 환경"이라는 뜻이다.
- 영속성 컨텍스트는 논리적인 개념이다.
- 엔티티 매니저를 통해 접근할 수 있다.

<br>
**이점**

- 1차 캐시
- 동일성(identity) 보장
- 트랜잭션을 지원하는 쓰기 지연(transactional write-behind)
- 변경 감지(Dirty Checking)
- 지연 로딩(Lazy Loading)

<br>
### 플러시

<img src = "https://user-images.githubusercontent.com/77649948/106992935-f3661c00-67bc-11eb-9336-d20fc798fc59.png" width="800">

영속성 컨텍스트의 변경내용을 데이터베이스에 반영

- 영속성 컨텍스트를 비우지 않는다.
- 영속성 컨텍스트의 변경내용을 데이터베이스에 동기화한다.
- 트랜잭션이라는 작업 단위가 중요하다. → 커밋 직전에만 동기화하면 된다.

<br>
**플러시 처리 과정**

1. 변경 감지
2. 수정된 엔티티를 쓰기 지연 SQL 저장소에 등록
3. 쓰기 지연 SQL 저장소의 쿼리를 데이터베이스에 전송 (등록, 수정, 삭제 쿼리)

<br>
**플러시 발생 경우**

- entityManager.flush() - 직접 호출
- 트랜잭션 커밋 - 플러시 자동 호출
- JPQL 쿼리 실행 - 플러시 자동 호출


<br>
<br>
<br>
----------------------------------------------------------------------------------------
<br>
참고: 김영한, [자바 ORM 표준 JPA 프로그래밍 - 기본편](https://www.inflearn.com/course/ORM-JPA-Basic/), Inflearn